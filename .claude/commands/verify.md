---
description: ì²´í¬ë¦¬ìŠ¤íŠ¸ ëŒ€ë¹„ êµ¬í˜„ ê²€ì¦. design ë©”ëª¨ë¦¬ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ì™€ ì‹¤ì œ ì½”ë“œ ë¹„êµ, ArchUnit í…ŒìŠ¤íŠ¸ ì‹¤í–‰.
tags: [project]
---

# /verify - êµ¬í˜„ ê²€ì¦

design ì²´í¬ë¦¬ìŠ¤íŠ¸ ëŒ€ë¹„ êµ¬í˜„ ì™„ë£Œ ì—¬ë¶€ë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.

## ì‚¬ìš© í˜•ì‹

```bash
/verify {feature}

# ì˜ˆì‹œ
/verify order-cancel

# íŠ¹ì • ë ˆì´ì–´ë§Œ ê²€ì¦
/verify order-cancel --layer domain
/verify order-cancel --layer application
```

---

## ì‹¤í–‰ í”„ë¡œì„¸ìŠ¤

```
/verify order-cancel
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ design ë©”ëª¨ë¦¬ ë¡œë“œ                                               â”‚
â”‚    - design-order-cancel ì½ê¸°                                       â”‚
â”‚    - ì²´í¬ë¦¬ìŠ¤íŠ¸ JSON íŒŒì‹±                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£ íŒŒì¼ ì¡´ì¬ í™•ì¸                                                   â”‚
â”‚    - ê° ì»´í¬ë„ŒíŠ¸ íŒŒì¼ ê²½ë¡œ í™•ì¸                                      â”‚
â”‚    - Serena find_symbolë¡œ ì‹¬ë³¼ ì¡´ì¬ í™•ì¸                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£ ê·œì¹™ ì¤€ìˆ˜ í™•ì¸                                                   â”‚
â”‚    - ê° ì»´í¬ë„ŒíŠ¸ë³„ rules_referenceë¡œ ê·œì¹™ ë©”ëª¨ë¦¬ ë¡œë“œ               â”‚
â”‚    - í•µì‹¬ ê·œì¹™ ìœ„ë°˜ ì—¬ë¶€ ì²´í¬                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4ï¸âƒ£ ArchUnit í…ŒìŠ¤íŠ¸ ì‹¤í–‰                                            â”‚
â”‚    - ./gradlew test --tests "*ArchTest*"                            â”‚
â”‚    - ì‹¤íŒ¨ ì‹œ ìƒì„¸ ë‚´ìš© í‘œì‹œ                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5ï¸âƒ£ ê²€ì¦ ë¦¬í¬íŠ¸ ìƒì„±                                                 â”‚
â”‚    - ë ˆì´ì–´ë³„ ì™„ë£Œìœ¨                                                 â”‚
â”‚    - ëˆ„ë½/ìœ„ë°˜ í•­ëª© ëª©ë¡                                            â”‚
â”‚    - ë‹¤ìŒ ì•¡ì…˜ ì œì•ˆ                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ê²€ì¦ í•­ëª©

### 1. íŒŒì¼ ì¡´ì¬ í™•ì¸

```python
# design ë©”ëª¨ë¦¬ì—ì„œ ì»´í¬ë„ŒíŠ¸ ëª©ë¡ ì¶”ì¶œ
for component in design.layers.domain.components:
    file_path = f"domain/{bc}/aggregate/{component.file}"

    # Serenaë¡œ íŒŒì¼/ì‹¬ë³¼ ì¡´ì¬ í™•ì¸
    result = mcp__serena__find_symbol(
        name_path_pattern=component.name,
        relative_path=file_path
    )

    if not result:
        missing.append(component)
```

### 2. ê·œì¹™ ì¤€ìˆ˜ í™•ì¸

```python
# ê° ì»´í¬ë„ŒíŠ¸ì˜ rules_referenceë¡œ ê·œì¹™ ë¡œë“œ
rules = mcp__serena__read_memory(
    memory_file_name=component.rules_reference  # "domain-rules-01-aggregate"
)

# í•µì‹¬ ê·œì¹™ ì²´í¬ (ERROR severityë§Œ)
for rule in rules.filter(severity="ERROR"):
    violation = check_rule(component, rule)
    if violation:
        violations.append(violation)
```

### 3. ë ˆì´ì–´ë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### Domain Layer
| ì²´í¬ í•­ëª© | ê²€ì¦ ë°©ë²• |
|----------|----------|
| Lombok ê¸ˆì§€ | íŒŒì¼ì— `@Data`, `@Getter` ë“± ì—†ìŒ |
| private ìƒì„±ì | `private {ClassName}(` íŒ¨í„´ ì¡´ì¬ |
| static factory | `forNew()`, `reconstitute()` ì¡´ì¬ |
| Instant ì‚¬ìš© | `LocalDateTime` ì—†ìŒ |

#### Application Layer
| ì²´í¬ í•­ëª© | ê²€ì¦ ë°©ë²• |
|----------|----------|
| @Service ì–´ë…¸í…Œì´ì…˜ | í´ë˜ìŠ¤ì— `@Service` ì¡´ì¬ |
| UseCase êµ¬í˜„ | `implements *UseCase` íŒ¨í„´ |
| @Transactional ê¸ˆì§€ (Service) | Serviceì— `@Transactional` ì—†ìŒ |
| Port ì§ì ‘ í˜¸ì¶œ ê¸ˆì§€ | `*Port` í•„ë“œ ì£¼ì… ì—†ìŒ |

#### Persistence Layer
| ì²´í¬ í•­ëª© | ê²€ì¦ ë°©ë²• |
|----------|----------|
| Long FK | `@ManyToOne`, `@OneToMany` ì—†ìŒ |
| JpaEntity ì ‘ë¯¸ì‚¬ | í´ë˜ìŠ¤ëª… `*JpaEntity` |
| protected ê¸°ë³¸ ìƒì„±ì | `protected {ClassName}()` ì¡´ì¬ |

#### REST API Layer
| ì²´í¬ í•­ëª© | ê²€ì¦ ë°©ë²• |
|----------|----------|
| @Valid ì‚¬ìš© | Request íŒŒë¼ë¯¸í„°ì— `@Valid` |
| Record DTO | Request/Responseê°€ `record` íƒ€ì… |

---

## ì¶œë ¥ í˜•ì‹

### ì„±ê³µ ì¼€ì´ìŠ¤

```markdown
## âœ… ê²€ì¦ ì™„ë£Œ: order-cancel

### ğŸ“Š ë ˆì´ì–´ë³„ ì™„ë£Œìœ¨

| ë ˆì´ì–´ | ì™„ë£Œ | ì „ì²´ | ë¹„ìœ¨ |
|--------|------|------|------|
| Domain | 4 | 4 | 100% âœ… |
| Application | 8 | 8 | 100% âœ… |
| Persistence | 4 | 4 | 100% âœ… |
| REST API | 3 | 3 | 100% âœ… |

### ğŸ§ª ArchUnit í…ŒìŠ¤íŠ¸
âœ… 218 tests passed

### ğŸ‰ ëª¨ë“  ê²€ì¦ í†µê³¼!
`/complete order-cancel`ë¡œ ì‘ì—…ì„ ì™„ë£Œí•˜ì„¸ìš”.
```

### ì‹¤íŒ¨ ì¼€ì´ìŠ¤

```markdown
## âš ï¸ ê²€ì¦ ê²°ê³¼: order-cancel

### ğŸ“Š ë ˆì´ì–´ë³„ ì™„ë£Œìœ¨

| ë ˆì´ì–´ | ì™„ë£Œ | ì „ì²´ | ë¹„ìœ¨ |
|--------|------|------|------|
| Domain | 4 | 4 | 100% âœ… |
| Application | 6 | 8 | 75% âš ï¸ |
| Persistence | 4 | 4 | 100% âœ… |
| REST API | 0 | 3 | 0% âŒ |

### âŒ ëˆ„ë½ëœ ì»´í¬ë„ŒíŠ¸

#### Application Layer
- [ ] `CancelOrderFacade` - íŒŒì¼ ì—†ìŒ
- [ ] `OrderTransactionManager` - íŒŒì¼ ì—†ìŒ

#### REST API Layer
- [ ] `OrderCommandController.cancel()` - ë©”ì„œë“œ ì—†ìŒ
- [ ] `CancelOrderRequest` - íŒŒì¼ ì—†ìŒ
- [ ] `OrderApiMapper` - íŒŒì¼ ì—†ìŒ

### âš ï¸ ê·œì¹™ ìœ„ë°˜

| íŒŒì¼ | ê·œì¹™ | ë‚´ìš© |
|------|------|------|
| `CancelOrderService.java` | APP-CS-003 | @Transactional ì‚¬ìš© ê¸ˆì§€ ìœ„ë°˜ |

### ğŸ§ª ArchUnit í…ŒìŠ¤íŠ¸
âŒ 2 tests failed
- `FacadeArchTest.facade_MustDependOnTransactionManager`
- `ServiceArchTest.service_MustNotHaveTransactional`

### ğŸ’¡ ë‹¤ìŒ ì•¡ì…˜
1. `CancelOrderFacade` ìƒì„± í•„ìš”
2. `CancelOrderService`ì—ì„œ @Transactional ì œê±°
3. REST API Layer êµ¬í˜„ í•„ìš”: `/impl:rest-api order-cancel`
```

---

## ArchUnit í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# ì „ì²´ ArchUnit í…ŒìŠ¤íŠ¸
./gradlew test --tests "*ArchTest*"

# íŠ¹ì • ë ˆì´ì–´ë§Œ
./gradlew :domain:test --tests "*ArchTest*"
./gradlew :application:test --tests "*ArchTest*"
```

---

## ê´€ë ¨ ì»¤ë§¨ë“œ

| ì»¤ë§¨ë“œ | ìš©ë„ |
|--------|------|
| `/status {feature}` | ê°„ë‹¨í•œ ì§„í–‰ë¥  í™•ì¸ |
| `/complete {feature}` | ê²€ì¦ í†µê³¼ í›„ ì™„ë£Œ ì²˜ë¦¬ |
| `/impl:{layer} {feature}` | ëˆ„ë½ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„ |
