<?xml version="1.0" encoding="UTF-8"?>
<!--
    SpotBugs Exclusion Configuration
    Enterprise Spring Boot Standards

    @author Architecture Team (arch-team@company.com)
    @since 2024-01-01
-->
<FindBugsFilter>
    <!-- ========================================
         Exclude Generated Code
         ======================================== -->
    <Match>
        <Class name="~.*\.Q.*"/>  <!-- QueryDSL generated classes -->
    </Match>

    <Match>
        <Package name="~.*\.generated\..*"/>
    </Match>

    <!-- ========================================
         Exclude Test Code from Certain Rules
         ======================================== -->
    <Match>
        <Class name="~.*Test"/>
        <Bug pattern="DMI_HARDCODED_ABSOLUTE_FILENAME"/>
    </Match>

    <!-- ========================================
         Configuration Classes
         ======================================== -->
    <Match>
        <Class name="~.*Configuration"/>
        <Bug pattern="UWF_FIELD_NOT_INITIALIZED_IN_CONSTRUCTOR"/>
    </Match>

    <!-- ========================================
         Domain Layer Exceptions
         Exception의 args()는 의도적으로 내부 배열 반환
         ======================================== -->
    <Match>
        <Class name="~.*Exception"/>
        <Bug pattern="EI_EXPOSE_REP"/>
    </Match>

    <!-- ========================================
         Locale-independent String operations
         enum/VO에서 입력 정규화는 locale-independent가 의도된 동작
         ======================================== -->
    <Match>
        <Package name="~com\.ryuqq\.setof\.domain\..*"/>
        <Bug pattern="DM_CONVERT_CASE"/>
    </Match>

    <!-- ========================================
         DTO/Response 내부 표현 노출 (의도된 동작)
         Record/DTO는 데이터 컨테이너이므로 내부 리스트 반환이 정상
         ======================================== -->
    <Match>
        <Or>
            <Class name="~.*Response"/>
            <Class name="~.*Command"/>
            <Class name="~.*Query"/>
            <Class name="~.*DTO"/>
            <Class name="~.*Dto"/>
        </Or>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         의존성 주입 패턴 (Spring 표준)
         생성자에서 외부 객체 저장은 DI 패턴의 정상 동작
         ======================================== -->
    <Match>
        <Or>
            <Class name="~.*Service"/>
            <Class name="~.*UseCase"/>
            <Class name="~.*Facade"/>
            <Class name="~.*Manager"/>
            <Class name="~.*Adapter"/>
            <Class name="~.*Handler"/>
            <Class name="~.*Controller"/>
            <Class name="~.*Repository"/>
        </Or>
        <Bug pattern="EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         JWT/Security 초기화 패턴
         JWT 키 초기화 시 예외 발생 가능 (의도된 fail-fast)
         ======================================== -->
    <Match>
        <Class name="~.*JwtTokenProvider.*"/>
        <Bug pattern="CT_CONSTRUCTOR_THROW"/>
    </Match>

    <!-- ========================================
         Redis/Redisson 설정 패턴
         Redisson Config 타입 캐스팅은 라이브러리 패턴
         ======================================== -->
    <Match>
        <Or>
            <Class name="~.*RedissonConfig"/>
            <Class name="~.*RedisConfig"/>
        </Or>
        <Bug pattern="BC_UNCONFIRMED_CAST,BC_UNCONFIRMED_CAST_OF_RETURN_VALUE"/>
    </Match>

    <!-- ========================================
         Cache Adapter 주입 필드
         ObjectMapper 등 인프라 필드는 향후 사용 예정
         ======================================== -->
    <Match>
        <Class name="~.*CacheAdapter"/>
        <Bug pattern="URF_UNREAD_FIELD"/>
    </Match>

    <!-- ========================================
         Spring Security Config 클래스
         Security 설정은 많은 의존성 주입 필요
         ======================================== -->
    <Match>
        <Or>
            <Class name="~.*SecurityConfig"/>
            <Class name="~.*SecurityPaths"/>
            <Class name="~.*Filter"/>
            <Class name="~.*ErrorMapperRegistry"/>
        </Or>
        <Bug pattern="EI_EXPOSE_REP2,MS_EXPOSE_REP,MS_MUTABLE_ARRAY,MS_SHOULD_BE_FINAL,MS_PKGPROTECT,UPM_UNCALLED_PRIVATE_METHOD"/>
    </Match>

    <!-- ========================================
         Spring @ConfigurationProperties 클래스
         Setter/Getter는 Spring 바인딩에 필요
         ======================================== -->
    <Match>
        <Class name="~.*Properties"/>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         Controller/Handler 의존성 주입
         Spring MVC 표준 패턴
         ======================================== -->
    <Match>
        <Or>
            <Class name="~.*Handler"/>
            <Class name="~.*Registry"/>
        </Or>
        <Bug pattern="EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         Exception Handling - Assert Null Check
         Spring이 null을 반환하지 않음을 신뢰
         ======================================== -->
    <Match>
        <Class name="~.*ExceptionHandler"/>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE"/>
    </Match>

    <!-- ========================================
         OAuth2 Handler Exception Catching
         URL 검증에서 예외 catch는 의도된 동작
         ======================================== -->
    <Match>
        <Class name="~.*OAuth2.*Handler"/>
        <Bug pattern="REC_CATCH_EXCEPTION"/>
    </Match>

    <!-- ========================================
         Query/Search DTO 내부 List 노출
         API Request는 내부 List 반환이 정상
         ======================================== -->
    <Match>
        <Or>
            <Class name="~.*ApiRequest"/>
            <Class name="~.*SearchApiRequest"/>
        </Or>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>
</FindBugsFilter>
